<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Machine Learning Atypical Femur Fracture (AFF) Risk Predictor</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="header-bar">
        Machine Learning Atypical Femur Fracture (AFF) Risk Predictor
    </div>
    <div class="sub-header" style="font-size: 0.9em;">
        For investigative use only. Not for clinical use
    </div>

    <!-- First Form -->
    <form id="form1" class="form-grid">

        <!-- First group of inputs: Patient History -->
        <fieldset>
            <legend>Patient History</legend>

            <label for="fieldPamidronate">Pamidronate Use (Y/N):</label>
            <select id="fieldPamidronate" name="fieldPamidronate">
                <option></option>
                <option>Y</option>
                <option>N</option>
            </select><br><br>

            <label for="fieldRisedronate">Risedronate Use (Y/N):</label>
            <select id="fieldRisedronate" name="fieldRisedronate">
                <option></option>
                <option>Y</option>
                <option>N</option>
            </select><br><br>

            <label for="fieldIbandronate">Ibandronate Use (Y/N):</label>
            <select id="fieldIbandronate" name="fieldIbandronate">
                <option></option>
                <option>Y</option>
                <option>N</option>
            </select><br><br>

            <label for="fieldZoledronate">Zoledronate Use (Y/N):</label>
            <select id="fieldZoledronate" name="fieldZoledronate">
                <option></option>
                <option>Y</option>
                <option>N</option>
            </select><br><br>

            <label for="fieldAlendronate">Alendronate Use (Y/N):</label>
            <select id="fieldAlendronate" name="fieldAlendronate">
                <option></option>
                <option>Y</option>
                <option>N</option>
            </select><br><br>

            <label for="fieldDenosumab">Denosumab Use (Y/N):</label>
            <select id="fieldDenosumab" name="fieldDenosumab">
                <option></option>
                <option>Y</option>
                <option>N</option>
            </select><br><br>

            <label for="fieldDuration">Duration of Bisphosphonate Use (Years):</label>
            <input type="text" id="fieldDuration" name="fieldDuration"><br><br>

            <label for="fieldPreviousNTF">Previous Non Traumatic Fracture (Y/N):</label>
            <select id="fieldPreviousNTF" name="fieldPreviousNTF">
                <option></option>
                <option>Y</option>
                <option>N</option>
            </select><br><br>

            <label for="fieldParent">Parent Fractured Hip? (Y/N):</label>
            <select id="fieldParent" name="fieldParent">
                <option></option>
                <option>Y</option>
                <option>N</option>
            </select><br><br>

            <label for="fieldSmoker">Current Smoker? (Y/N):</label>
            <select id="fieldSmoker" name="fieldSmoker">
                <option></option>
                <option>Y</option>
                <option>N</option>
            </select><br><br>

            <label for="fieldSteroid">Steroid Use (>3 months) (Y/N):</label>
            <select id="fieldSteroid" name="fieldSteroid">
                <option></option>
                <option>Y</option>
                <option>N</option>
            </select><br><br>

            <label for="fieldRA">Rheumatoid Arthritis (Y/N):</label>
            <select id="fieldRA" name="fieldRA">
                <option></option>
                <option>Y</option>
                <option>N</option>
            </select><br><br>

            <label for="fieldSO">History of Secondary Osteoporosis (Y/N):</label>
            <select id="fieldSO" name="fieldSO">
                <option></option>
                <option>Y</option>
                <option>N</option>
            </select><br><br>

            <label for="fieldAlcoholism">Alcoholism (>3 drinks per day) (Y/N):</label>
            <select id="fieldAlcoholism" name="fieldAlcoholism">
                <option></option>
                <option>Y</option>
                <option>N</option>
            </select><br><br>
        </fieldset>
    </form>

    <!-- Second Form -->
    <form id="form2" class="form-grid">

        <!-- Second group of inputs: Radiographic Data -->
        <fieldset>
            <legend>Radiographic Data</legend>
            <label for="medialCorticalThickness">Femoral Medial Cortical Thickness at 50 mm (mm):</label>
            <input type="text" id="medialCorticalThickness" name="fieldMCT"><br><br>

            <label for="lateralCorticalThickness">Femoral Lateral Cortical Thickness at 50 mm (mm):</label>
            <input type="text" id="lateralCorticalThickness" name="fieldLCT"><br><br>

            <label for="offset">Femoral Horizontal Offset (mm):</label>
            <input type="text" id="offset" name="fieldOffset"><br><br>

            <label for="femoralNeckAngle">Femoral Neck Angle (Degrees):</label>
            <input type="text" id="femoralNeckAngle" name="fieldFMA"><br><br>

            <label for="femoralHeadDiameter">Femoral Head Diameter (mm):</label>
            <input type="text" id="femoralHeadDiameter" name="fieldFMD"><br><br>

            <label for="verticalOffset">Femoral Vertical Offset (mm):</label>
            <input type="text" id="verticalOffset" name="fieldVO"><br><br>

            <label for="femoralNeckThickness">Femoral Neck Thickness (mm):</label>
            <input type="text" id="femoralNeckThickness" name="fieldFMT"><br><br>
        </fieldset>

        <!-- Third group of inputs: DXA Scan Results -->
        <fieldset>
            <legend>DXA Scan Results</legend>
            <label for="fieldDXABMD">DXA Femoral Neck BMD (g/cm^2):</label>
            <input type="text" id="fieldDXABMD" name="fieldDXABMD"><br><br>

            <label for="fieldDXALumbar">DXA L1-L4 BMD (g/cm^2):</label>
            <input type="text" id="fieldDXALumbar" name="fieldDXALumbar"><br><br>
        </fieldset>

        <!-- Fourth group of inputs: FRAX Scores -->
        <fieldset>
            <legend>FRAX Scores</legend>
            <label for="fieldFraxMajor">Probability of Major Fracture Within 10 Years (%):</label>
            <input type="text" id="fieldFraxMajor" name="fieldFraxMajor"><br><br>

            <label for="fieldFraxHip">Probability of Hip Fracture Within 10 Years (%):</label>
            <input type="text" id="fieldFraxHip" name="fieldFraxHip"><br><br>
        </fieldset>
    </form>

    <!-- Submit Button for Both Forms -->
    <div class="submit-container">
        <button id="submitBtn" type="button">Submit</button>
    </div>

    <!-- Output for Prediction and Confidence -->
    <div class="output-container">
        <fieldset>
            <legend>Prediction Results</legend>
            <label for="predictionOutput">Prediction:</label>
            <input type="text" id="predictionOutput" readonly><br><br>

            <label for="confidenceOutput">Confidence:</label>
            <input type="text" id="confidenceOutput" readonly><br><br>
        </fieldset>
    </div>

    <script>
        document.getElementById("submitBtn").addEventListener("click", function(event) {
            event.preventDefault(); // Prevent the default form submission

            // Get form data from both forms
            var form1Data = new FormData(document.getElementById("form1"));
            var form2Data = new FormData(document.getElementById("form2"));

            // Combine both form data into a single object
            var combinedData = new FormData();

            // Append form1 data
            form1Data.forEach((value, key) => {
                combinedData.append(key, value);
            });

            // Append form2 data
            form2Data.forEach((value, key) => {
                combinedData.append(key, value);
            });

            // Convert form data to JSON object
            var jsonData = JSON.stringify(Object.fromEntries(combinedData.entries()));

            // Send the combined form data to the FastAPI endpoint
            fetch('http://127.0.0.1:8000/submit/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: jsonData
            })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                // Display the prediction and confidence on the webpage
                document.getElementById("predictionOutput").value = data.Prediction;
                document.getElementById("confidenceOutput").value = data.Probability;
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred. Please try again later.');
            });
        });
    </script>
</body>

</html>
