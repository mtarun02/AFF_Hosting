<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Machine Learning Atypical Femur Fracture (AFF) Risk Predictor</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="header-bar">
        Machine Learning Atypical Femur Fracture (AFF) Risk Predictor
    </div>
    <div class="sub-header" style="font-size: 1em;">
        For investigative use only. Not for clinical use. Numbered features indicate top 15 important feature rankings for prediction.
    </div>

    <!-- First Form -->
    <form id="form1" class="form-grid">

        <!-- First group of inputs: Patient History -->
        <fieldset>
            <legend>Patient Clinical History</legend>

            <label for="fieldAlendronate">(1) Alendronate Use (Y/N):</label>
            <select id="fieldAlendronate" name="fieldAlendronate">
                <option></option>
                <option>Y</option>
                <option>N</option>
            </select><br><br>

            <label for="fieldDuration">(2) Duration of Bisphosphonate Use (Years):</label>
            <input type="text" id="fieldDuration" name="fieldDuration"><br><br>

            <label for="fieldSteroid">(3) Steroid Use for 3 or more months (Y/N):</label>
            <select id="fieldSteroid" name="fieldSteroid">
                <option></option>
                <option>Y</option>
                <option>N</option>
            </select><br><br>

            <label for="fieldZoledronate">(4) Zoledronate Use (Y/N):</label>
            <select id="fieldZoledronate" name="fieldZoledronate">
                <option></option>
                <option>Y</option>
                <option>N</option>
            </select><br><br>

            <label for="fieldSO">(8) History of Secondary Osteoporosis (Y/N):</label>
            <select id="fieldSO" name="fieldSO">
                <option></option>
                <option>Y</option>
                <option>N</option>
            </select><br><br>

            <label for="fieldPreviousNTF">(10) Previous Non Traumatic Fracture (Y/N):</label>
            <select id="fieldPreviousNTF" name="fieldPreviousNTF">
                <option></option>
                <option>Y</option>
                <option>N</option>
            </select><br><br>

            <label for="fieldDenosumab">(11) Denosumab Use (Y/N):</label>
            <select id="fieldDenosumab" name="fieldDenosumab">
                <option></option>
                <option>Y</option>
                <option>N</option>
            </select><br><br>

            <label for="fieldRA">(12) Rheumatoid Arthritis (Y/N):</label>
            <select id="fieldRA" name="fieldRA">
                <option></option>
                <option>Y</option>
                <option>N</option>
            </select><br><br>

            <label for="fieldParent">Parent Fractured Hip? (Y/N):</label>
            <select id="fieldParent" name="fieldParent">
                <option></option>
                <option>Y</option>
                <option>N</option>
            </select><br><br>


            <label for="fieldSmoker">Current Smoker? (Y/N):</label>
            <select id="fieldSmoker" name="fieldSmoker">
                <option></option>
                <option>Y</option>
                <option>N</option>
            </select><br><br>

            <label for="fieldAlcoholism">Alcohol Use (>3 drinks per day) (Y/N):</label>
            <select id="fieldAlcoholism" name="fieldAlcoholism">
                <option></option>
                <option>Y</option>
                <option>N</option>
            </select><br><br>

            <label for="fieldPamidronate">Pamidronate Use (Y/N):</label>
            <select id="fieldPamidronate" name="fieldPamidronate">
                <option></option>
                <option>Y</option>
                <option>N</option>
            </select><br><br>

            <label for="fieldRisedronate">Risedronate Use (Y/N):</label>
            <select id="fieldRisedronate" name="fieldRisedronate">
                <option></option>
                <option>Y</option>
                <option>N</option>
            </select><br><br>

            <label for="fieldIbandronate">Ibandronate Use (Y/N):</label>
            <select id="fieldIbandronate" name="fieldIbandronate">
                <option></option>
                <option>Y</option>
                <option>N</option>
            </select><br><br>


        </fieldset>
    </form>

    <!-- Second Form -->
    <form id="form2" class="form-grid">

        <!-- Second group of inputs: Radiographic Data -->
        <fieldset>
            <legend>Radiographic Data</legend>

            <label for="femoralNeckAngle">(5) Femoral Neck Angle (Degrees):</label>
            <input type="text" id="femoralNeckAngle" name="fieldFMA"><br><br>

            <label for="offset">(6) Femoral Horizontal Offset (mm):</label>
            <input type="text" id="offset" name="fieldOffset"><br><br>


            <label for="verticalOffset">(9) Femoral Vertical Offset (mm):</label>
            <input type="text" id="verticalOffset" name="fieldVO"><br><br>

            <label for="femoralNeckThickness">(12) Femoral Neck Thickness (mm):</label>
            <input type="text" id="femoralNeckThickness" name="fieldFMT"><br><br>

            <label for="femoralHeadDiameter">(13) Femoral Head Diameter (mm):</label>
            <input type="text" id="femoralHeadDiameter" name="fieldFMD"><br><br>

            <label for="lateralCorticalThickness">(14) Femoral Lateral Cortical Thickness at 50 mm (mm):</label>
            <input type="text" id="lateralCorticalThickness" name="fieldLCT"><br><br>

            <label for="medialCorticalThickness">Femoral Medial Cortical Thickness at 50 mm (mm):</label>
            <input type="text" id="medialCorticalThickness" name="fieldMCT"><br><br>




        </fieldset>

        <!-- Third group of inputs: DXA Scan Results -->
        <fieldset>
            <legend>DXA Scores</legend>
            <label for="fieldDXABMD">(7) Femoral Neck BMD T-Score:</label>
            <input type="text" id="fieldDXABMD" name="fieldDXABMD"><br><br>

            <label for="fieldDXALumbar">(11) L1-L4 BMD T-Score:</label>
            <input type="text" id="fieldDXALumbar" name="fieldDXALumbar"><br><br>
        </fieldset>

        <!-- Fourth group of inputs: FRAX Scores -->
        <fieldset>
            <legend>FRAX Scores</legend>
            <label for="fieldFraxMajor">(15) Probability of Major Fracture Within 10 Years (%):</label>
            <input type="text" id="fieldFraxMajor" name="fieldFraxMajor"><br><br>

            <label for="fieldFraxHip">Probability of Hip Fracture Within 10 Years (%):</label>
            <input type="text" id="fieldFraxHip" name="fieldFraxHip"><br><br>
        </fieldset>
    </form>

    <!-- Submit Button for Both Forms -->
    <div class="submit-container">
        <button id="submitBtn" type="button">Submit</button>
    </div>

    <!-- Output for Prediction and Confidence -->
    <div class="output-container">
        <fieldset>
            
            <legend></legend>
            <label for="predictionOutput">High AFF Risk?:</label>
            <input type="text" id="predictionOutput" readonly><br><br>

            <label for="confidenceOutput">Confidence level for prediction:</label>
            <input type="text" id="confidenceOutput" readonly><br>
        </fieldset>
    </div>

    <script>
        document.getElementById("submitBtn").addEventListener("click", function(event) {
            event.preventDefault(); // Prevent the default form submission

            // Get form data from both forms
            var form1Data = new FormData(document.getElementById("form1"));
            var form2Data = new FormData(document.getElementById("form2"));

            // Combine both form data into a single object
            var combinedData = new FormData();

            // Append form1 data
            form1Data.forEach((value, key) => {
                combinedData.append(key, value);
            });

            // Append form2 data
            form2Data.forEach((value, key) => {
                combinedData.append(key, value);
            });

            // Convert form data to JSON object
            var jsonData = JSON.stringify(Object.fromEntries(combinedData.entries()));

            // Send the combined form data to the FastAPI endpoint
            //fetch('http://127.0.0.1:8000/submit/', {

            //fetch('aff-python-repo.vercel.app/', {

            fetch('https://affpythonrepo.onrender.com/', {


                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: jsonData
            })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                // Display the prediction and confidence on the webpage
                var affPrediction = data.Prediction == 1 ? "Yes" : "No";
                var probability = (data.Probability * 100).toFixed(0) + "%";


                document.getElementById("predictionOutput").value = affPrediction;
                document.getElementById("confidenceOutput").value = probability;
                console.log("Prediction result:", data.Prediction);

            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred. Please try again later.');
            });
        });
    </script>
</body>

</html>
